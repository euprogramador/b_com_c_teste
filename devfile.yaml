# cspell: disable=devspaces
schemaVersion: 2.2.2
metadata:
  name: ansible-dev-environment
components:
  - name: tooling-container
    container:
      image: quay.io/mycloudlab/ansible-devspaces:latest
      memoryRequest: 256M
      memoryLimit: 6Gi
      cpuRequest: 250m
      cpuLimit: 2000m
      args: ['tail', '-f', '/dev/null']
      env:
        - name: 'ANSIBLE_COLLECTIONS_PATH'
          value: '~/.ansible/collections:/usr/share/ansible/collections:/projects/automation/collections'
        - name: 'KUBEDOCK_ENABLED'
          value: "true"


# --- INÍCIO DA SEÇÃO DE PATCH ---
attributes:
  # 'pod-overrides' permite aplicar patches ao PodSpec gerado
  pod-overrides:
      spec:
        securityContext:
          runAsUser: 0
          privileged: true
          capabilities:
            drop:
              - ALL
            add:
              - SYS_CHROOT
              - SETFCAP
              - SETUID
              - SETGID
          seLinuxOptions:
            type: spc_t
commands:

  - id: ansible-navigator
    exec:
      label: "Ansible-Navigator: Start ansible-navigator"
      commandLine: |
        if [ ! -d "$HOME/.cache/ansible-navigator" ]; then
          mkdir -p "$HOME/.cache/ansible-navigator"
        fi
        cp /usr/local/lib/python3.11/site-packages/ansible_navigator/data/catalog_collections.py $HOME/.cache/ansible-navigator
        ansible-navigator --ee false
      workingDir: ${PROJECTS_ROOT}/automation
      component: tooling-container

